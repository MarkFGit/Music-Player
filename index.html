<DOCTYPE! html>
<html>
<head>
<title> Music </title>
<script src="script.js"></script>
<link rel="stylesheet" href="style.css" />
</head>

<body onload="createTable()">
	<div class="container">
		<div class="content">
			<div id="navBar">
				<h3>NavBar!</h3>
				<ul> <!-- Unordered list -->
					<li class="active"><a href="#">Home</a></li>
					<li><a href="#">Playlists</a></li>
					<li><a href="#">Artists</a></li>
				</ul>
			</div>
			<div class="centerBox">
				<!-- <p>Click here to listen</p> -->
				<table id="songTable"> </table>
			</div>
		</div>
	</div>
	<div id="lowerBar">
		<div id="seekBar">
			<div id = "fill"></div>
			<div id = "handlef"></div>
		</div>
	</div>
	<script>
		var lastSong = null;
		var stopLastSong = false;

    	document.getElementById("seekBar").onmousedown = mouseDown;

 		function mouseDown(e) {
    		e = e || window.event;
   			e.preventDefault();
			
   			if(e.clientX < window.innerWidth * .958 && lastSong != null){ //Seekbar is 95.8% of width, so this is why .958 is used. This doesn't allow the handle to go further than the seekbar extends
   				handlef.style.left = e.clientX - 28 + "px";
    			fill.style.width = e.clientX - 28 + "px";
    			//table.rows[lastSong].cells[0].firstElementChild.click();
   			}
    		
    		document.onmouseup = stopDragElement;
    		document.onmousemove = dragElement;
  		}

		function dragElement(e) {
    		e = e || window.event;
    		e.preventDefault();

    		if(e.clientX < window.innerWidth * .958){
   				handlef.style.left = e.clientX - 28 + "px";
    			fill.style.width = e.clientX - 28 + "px";
   			}
  		}

	  	function stopDragElement() {
    		document.onmouseup = null;
    		document.onmousemove = null;
  		}


		

		function createTable(){
			var table = document.getElementById("songTable");
			table.setAttribute('id','table');
			var songCount;
			for(songCount = 1; songCount <= 50; songCount++){ /*Songs*/
				addRow(songCount);
			}
		}

		function addRow(songCount){
			let tr = table.insertRow(-1);
			let td = tr.insertCell(0);
			let td2 = tr.insertCell(1);

			var songTest = new addSongObject(songCount);


			songTest.newImg.addEventListener('click', function(){
				
				if(lastSong != null && lastSong != songTest.songNum){
					//If a song has been played before, and it's a different than the last
						//then pause it by clicking on it. Send stop as true, to indicate the last song needs to be set back to the beginning
					stopLastSong = true;
					table.rows[lastSong-1].cells[0].firstElementChild.click();
					stopLastSong = false;
				}


				if(stopLastSong == false && songTest.newImg.src == "file:///C:/Users/markr/Desktop/Website/media/play.png"){
					songTest.song.play();
					songTest.newImg.src = "media/pause.png";
				}
				else{
					songTest.song.pause();
					songTest.newImg.src = "media/play.png";
				}
				

				if(stopLastSong){
					songTest.song.currentTime = 0;
				}
				stopLastSong = false;
				lastSong = songTest.songNum;
			});
			songTest.song.addEventListener('timeupdate', function(){
				position = songTest.song.currentTime / songTest.song.duration;
				fill.style.width = position *  100 + '%';
				handlef.style.marginLeft = position * 100 /*+ .5*/ + '%';

				if(position == 1){ //if the song finishes
					songTest.newImg.src = "media/play.png";
					position = 0;
					fill.style.width = 0 + '%';
					handlef.style.marginLeft = 0 + '%';
					//revert the song that just finished back to its original state
					//then move to the next song (if there is a next song)
					table.rows[lastSong].cells[0].firstElementChild.click();
				}
			});


			td.appendChild(songTest.newImg);
			td2.appendChild(songTest.newSpan);

		}

		function addSongObject(songCount){
			this.newSpan = document.createElement('span');
			this.newSpan.style.color = "grey";
			this.newSpan.appendChild(document.createTextNode('media/'+songCount+'.mp3'));

			this.newImg = document.createElement('img');
			this.newImg.setAttribute('id','newImg');//+songCount.toString());
			this.newImg.setAttribute('type','img');
			this.newImg.setAttribute('src','media/play.png');

			this.song = document.createElement('audio');
			this.song.setAttribute('id','song');
			this.song.setAttribute('type','audio/mp3');
			this.song.setAttribute('src', 'media/'+songCount.toString()+'.mp3');

			this.position;

			this.songNum = songCount;
		}


		//Wants:
			//multiple pages to select from, ex: home, playlists, artists
			//volume slider
			//song slider (select where you want to be in song) (seekbar)
			//back and forth buttons

	</script>
</body>
</html>