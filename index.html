<DOCTYPE! html>
<html>
<head>
<title> Music </title>
<script src="script.js"></script>
<link rel="stylesheet" href="style.css" />
</head>

<body onload="createTable()">
	<div class="container">
		<div class="content">
			<div id="navBar">
				<h3>NavBar!</h3>
				<ul> <!-- Unordered list -->
					<li class="active"><a href="#">Home</a></li>
					<li><a href="#">Playlists</a></li>
					<li><a href="#">Artists</a></li>
				</ul>
			</div>
			<div class="centerBox">
				<p>Click here to listen</p>
				<div id = "seekBar">
					<div id = "fill"></div>
					<div id = "handlef"></div>
				</div>
				<table id="songTable"> </table>
			</div>
		</div>
	</div>
	<audio id="song1">
		<source src="media/1.mp3" type="audio/mp3">
	</audio>
	<audio id="song2">
		<source src="media/2.mp3" type="audio/mp3">
	</audio>
	<script>
		var lastSong = null;
		var stop = null;
		function createTable(){
			var table = document.getElementById("songTable");
			table.setAttribute('id','table');
			var songCount;
			for(songCount = 1; songCount <= 5; songCount++){ /*Songs*/
				//var row = table.insertRow(0);
				//var cell1 = row.insertCell(0);
				//cell1.innerHTML = "NEW CELL"; 
				addRow(songCount);
			}
		}

		function addRow(songCount){
			let tr = table.insertRow(-1);
			let td = tr.insertCell(0);
			let td2 = tr.insertCell(1);

			var songTest = new addSongObject(songCount);

			/*songTest.newImg.setAttribute('id','newImg');//+songCount.toString());
			songTest.newImg.setAttribute('type','img');
			songTest.newImg.setAttribute('src','media/play.png');*/

/*			songTest.song.setAttribute('id','song');
			songTest.song.setAttribute('type','audio/mp3');
			songTest.song.setAttribute('src', 'media/'+songCount.toString()+'.mp3');*/

			songTest.newImg.addEventListener('click', function(){
				
				//stopOtherSongs(songTest.songNum);
				if(lastSong != null && lastSong != songTest.songNum && table.rows[lastSong-1].cells[0].firstElementChild.src == "file:///C:/Users/markr/Desktop/Website/media/pause.png" && stop == false){
					//If a song has been played before, and it's a different than the last, and it's currently playing...
						//then pause it by clicking on it, send a 1 to indicate the song needs to stat from beginning
					table.rows[lastSong-1].cells[0].firstElementChild.click();
					stop = true;
				}
				else{ stop = false }

/*				songTest.song.addEventListener('timeupdate', function(){
					position = songTest.song.currentTime / songTest.song.duration;
					fill.style.width = position *  100 + '%';
					handlef.style.marginLeft = 100 * position + '%';

					if(position == 1){
						songTest.newImg.src = "media/play.png";
						position = 0;
						fill.style.width = 0 + '%';
						handlef.style.marginLeft = 0 + '%';
					}
				});*/

				if(songTest.newImg.src == "file:///C:/Users/markr/Desktop/Website/media/play.png"){
					songTest.song.play();
					songTest.newImg.src = "media/pause.png";
					if(stop){ //please figure out in the morning
						songTest.song.currentTime = 0;
						stop = false;
					}
				}
				else{
					songTest.song.pause();
					songTest.newImg.src = "media/play.png";
					if(stop){
						songTest.song.currentTime = 0;
						stop = false;
					}
				}

				lastSong = songTest.songNum;
			});
			songTest.song.addEventListener('timeupdate', function(){
				position = songTest.song.currentTime / songTest.song.duration;
				fill.style.width = position *  100 + '%';
				handlef.style.marginLeft = 100 * position + '%';

				if(position == 1){
					songTest.newImg.src = "media/play.png";
					position = 0;
					fill.style.width = 0 + '%';
					handlef.style.marginLeft = 0 + '%';
				}
			});

			td.appendChild(songTest.newImg);
			td2.appendChild(songTest.newText);

		}

		function addSongObject(songCount){
			this.newText = document.createTextNode('media/'+songCount+'.mp3');

			this.newImg = document.createElement('img');
			this.newImg.setAttribute('id','newImg');//+songCount.toString());
			this.newImg.setAttribute('type','img');
			this.newImg.setAttribute('src','media/play.png');

			this.song = document.createElement('audio');
			this.song.setAttribute('id','song');
			this.song.setAttribute('type','audio/mp3');
			this.song.setAttribute('src', 'media/'+songCount.toString()+'.mp3');

			this.position;// = this.song.currentTime / this.song.duration;

			this.songNum = songCount;
			//if(songCount == 1){
/*			this.newImg.addEventListener('click',function(){
				//let mySong1 = document.getElementById('song1');
				//mySong1.setAttribute('type','audio/mp3');
				//mySong1.setAttribute('src', 'media/'+songCount.toString()+'.mp3');
				
				this.song.addEventListener('timeupdate', function(){
					this.position = this.song.currentTime / this.song.duration;
					fill.style.width = this.position *  100 + '%';
					handlef.style.marginLeft = 100 * this.position + '%';
					//this.newText = '1';
					//songTest.newText = document.createTextNode(position);
					if(position == 1){
						this.newImg.src = "media/play.png";
						//position = 0;
						fill.style.width = 0 + '%';
						handlef.style.marginLeft = 0 + '%';
					}
				});
				if(this.newImg.src == "file:///C:/Users/markr/Desktop/Website/media/play.png"){//mySong1.paused){
					this.song.play();
					//mySong1.currentTime = position;// * mySong1.duration;
					this.newImg.src = "media/pause.png";
				}
				else{
					this.song.pause();
					this.newImg.src = "media/play.png";
				}
			});*/

		}

		function stopOtherSongs(songNum){

			for (var i = table.rows.length - 1; i >= 0; i--) {
				if(i != songNum-1 && table.rows[i].cells[0].firstElementChild.src == "file:///C:/Users/markr/Desktop/Website/media/pause.png"){
					//var stop = 1;
					table.rows[i].cells[0].firstElementChild.foo(1); //clicks on each play button, which corresponds to a unique song
				}
			}
		}


		function playSong(){


		}
		//function newSound(songCount){
			//this.type = ''
			//this.src = 'media/'+songCount.toString()+'.mp3';

			//return this;
		//}


		//Wants:
			//multiple pages to select from, ex: home, playlists, artists
			//volume slider
			//song slider (select where you want to be in song)
			//back and forth buttons
			//need to fix such that only one song is "playing" at once

	</script>
	<!--h1>Hello World!</h1-->
	<!--button onclick="revealMessage()">Click me</button-->
	<!--p id="hiddenMessage" style="display:none">You are going to die</p-->
</body>
</html>